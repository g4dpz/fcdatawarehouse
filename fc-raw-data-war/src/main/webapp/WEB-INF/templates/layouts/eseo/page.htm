<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="icon" type="image/png" th:href="@{/images/favicon-16x16.png}" sizes="16x16">
    <link rel="icon" type="image/png" th:href="@{/images/favicon-24x24.png}" sizes="24x24">
    <link rel="icon" type="image/png" th:href="@{/images/favicon-32x32.png}" sizes="32x32">
    <link rel="icon" type="image/png" th:href="@{/images/favicon-64x64.png}" sizes="64x64">
    <link rel="shortcut icon" th:href="@{/images/favicon.ico}">
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&amp;subset=cyrillic,cyrillic-ext,greek,greek-ext,latin-ext" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/bundle.min.css}">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/ju/dt-1.10.18/datatables.min.css"/>
    <title layout:title-pattern="$CONTENT_TITLE &middot; $LAYOUT_TITLE">AMSAT-UK Data Warehouse</title>
</head>
<body class="bg-light">

<div class="container-fluid">
    <div class="row flex-xl-nowrap">

        <div th:replace="fragments/eseo/sidebar :: default"></div>

        <div class="d-block px-24 px-md-32 DashMainWrapper">
            <main role="main" class="DashMain">
                <div layout:fragment="main"></div>
            </main>
        </div>

    </div>
</div>

<script src="/js/bundle.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/v/ju/dt-1.10.18/datatables.min.js"></script>
<script layout:fragment="script"></script><script>
    $(document).ready(function(){
        refreshRealtime();
        setInterval(refreshRealtime, 5000);
    });
</script>

<script>
    function refreshRealtime(){

        var url = "/eseo/data/realtime";

        $.ajax({
            type: "GET",
            url: url,
            contentType: "application/json",
            accepts : "application/json",
            dataType: "jsonp",
            crossDomain: true,
            cache: false,
            success : handleRealtime
        });
    }
</script>

<script>
    var handleRealtime = function(data) {

        $("#info_seqno").text("Seq. No.: " + data.data.sequenceNumber);
        $("#info_packet_count").text("Packets: " + data.data.packetCount);
        $("#created_date").text(data.data.createdDate);
        $("#lat_long").text(data.data.latLong);

        $("#dcConvVoltsOut_value").text(data.data.epsDTO.dcConvVoltsOut + " V");
        $("#dcConvCurrOut_value").text(data.data.epsDTO.dcConvCurrOut + " mA");
        $("#dcConvTemp_value").text(data.data.epsDTO.dcConvTemp + " C");
        $("#enclosureTemp_value").text(data.data.epsDTO.enclosureTemp + " C");
        $("#cctProcTemp_value").text(data.data.epsDTO.cctProcTemp + " C");
        $("#volts3v3_value").text(data.data.epsDTO.volts3v3 + " V");
        $("#curr3v3_value").text(data.data.epsDTO.curr3v3 + " mA");
        $("#volts6v9_value").text(data.data.epsDTO.volts6v9 + " V");
        $("#curr6v9_value").text(data.data.epsDTO.curr6v9 + " mA");
        $("#volts9v_value").text(data.data.epsDTO.volts9v + " V");
        $("#curr9v_value").text(data.data.epsDTO.curr9v + " mA");

        $("#fmTxTemp_value").text(data.data.paDTO.fmTxTemp + " C");
        $("#bpskTemp_value").text(data.data.paDTO.bpskTemp + " C");
        $("#txRevPwr_value").text(data.data.paDTO.txRevPwr + " mW");
        $("#txFwdPwr_value").text(data.data.paDTO.txFwdPwr + " mW");
        $("#bpskCurr_value").text(data.data.paDTO.bpskCurr + " mA");
        $("#bpsk3v3_value").text(data.data.paDTO.bpsk3v3 + " V");

        $("#lBandTranspRxRssi_value").text(data.data.rfDTO.lBandTranspRxRssi);
        $("#lBandCmdRxRssi_value").text(data.data.rfDTO.lBandCmdRxRssi);
        $("#lBandCmdRxDop_value").text(data.data.rfDTO.lBandCmdRxDop);
        $("#lBandCmdRxTemp_value").text(data.data.rfDTO.lBandCmdRxTemp + " C");

        $("#sequenceNumber_value").text(data.data.swDTO.sequenceNumber);
        $("#dtmfLastCmd_value").text(data.data.swDTO.dtmfLastCmd);
        $("#rfMode_value").text(data.data.swDTO.rfMode);
        $("#dataMode_value").text(data.data.swDTO.dataMode);
        $("#payloadStatus_value").text(data.data.swDTO.payloadStatus);
        $("#inEclipseMode_value").text(data.data.swDTO.inEclipseMode);
        $("#inAutoMode_value").text(data.data.swDTO.inAutoMode);
        $("#ctcssDetect_value").text(data.data.swDTO.ctcssDetect);
        $("#safeModeState_value").text(data.data.swDTO.safeModeState);
        $("#inSafeMode_value").text(data.data.swDTO.inSafeMode);

        $("#site_list").html('');
        var items = [];
        $.each(data.data.sites, function (id, site) {
            items.push('<li>' + site + '</li>');
        });
        $("#site_list").append(items.join(''));


    }
</script>

</body>
</html>